package com.proutechos.sandbox.radiolivealacarte.server.service;import com.proutechos.sandbox.radiolivealacarte.server.model.Program;import com.proutechos.sandbox.radiolivealacarte.server.model.UserModel;import com.proutechos.sandbox.radiolivealacarte.server.service.recording.RecordName;import com.proutechos.utils.server.rest.config.exceptions.ProutechosBaseException;import java.time.LocalTime;import java.util.ArrayList;import java.util.List;import java.util.UUID;public class RadioLiveALaCarteUserService {    public String createAccount(UserModel newUser) throws ProutechosBaseException {        try {            // Create a new BankAccount            String newAccountId = UUID.randomUUID().toString();            newUser.setId(newAccountId);            // Store it            RadioLiveALaCarteDataStorage.getInstance().createAccount(newUser);            UserModel user = RadioLiveALaCarteDataStorage.getInstance().getUserById(newAccountId);            return user.getId();        } catch (ProutechosBaseException e) {            throw e;        }    }    public UserModel getUserByID(String userID) throws ProutechosBaseException {        try {            return RadioLiveALaCarteDataStorage.getInstance().getUserById(userID);        } catch (ProutechosBaseException e) {            throw e;        }    }    public String createProgram(Program newProgram) throws ProutechosBaseException {        try {            // Create a new BankAccount            String newProgramId = UUID.randomUUID().toString();            newProgram.setId(newProgramId);            // Store it            RadioLiveALaCarteDataStorage.getInstance().createProgram(newProgram);            Program program = RadioLiveALaCarteDataStorage.getInstance().getProgramById(newProgramId);            return program.getId();        } catch (ProutechosBaseException e) {            throw e;        }    }    public Boolean doesUserExists(String userId) throws ProutechosBaseException {        try {            return RadioLiveALaCarteDataStorage.getInstance().doesUserExists(userId);        } catch (ProutechosBaseException e) {            throw e;        }    }    public void addUserProgram(String userId, String programId) throws ProutechosBaseException {        try {            RadioLiveALaCarteDataStorage.getInstance().addUserProgram("aa768288-7621-49c8-99bd-c33c6fc02cc5", "e8d96a9e-d0cf-48de-a06b-809ecc95305c");        } catch (ProutechosBaseException e) {            throw e;        }    }    public Program[] getProgramsByUserId(String userId) throws ProutechosBaseException {        try {            return RadioLiveALaCarteDataStorage.getInstance().getProgramsByUserId(userId);        } catch (ProutechosBaseException e) {            throw e;        }    }    public List<Program> getProgramsByRadioName(String inputRadioName) throws ProutechosBaseException {        try {            return RadioLiveALaCarteDataStorage.getInstance().getProgramsByRadioName(inputRadioName);        } catch (ProutechosBaseException e) {            throw e;        }    }    public void deleteUserProgram(String idProgram, String idUser) throws ProutechosBaseException {        try {            RadioLiveALaCarteDataStorage.getInstance().deleteUserProgram(idProgram, idUser);        } catch (ProutechosBaseException e) {            throw e;        }    }    private Boolean isHourlyAlreadyPassed(int hour, int minute, int second) {            // Obtenir l'heure actuelle            LocalTime now = LocalTime.now();            // Construire l'heure à vérifier            LocalTime targetTime = LocalTime.of(hour, minute, second);            // Vérifier si l'heure est passée            if (now.isAfter(targetTime)) {                return Boolean.TRUE;            } else {                return Boolean.FALSE;            }    }    public RecordName getSuitableFileNameByProgramId(String programId) throws ProutechosBaseException {        Program program = RadioLiveALaCarteDataStorage.getInstance().getProgramById(programId);        int startHour = program.getStartTimeHour();        int startMinute = program.getStartTimeMinute();        int startSeconds = program.getStartTimeSeconds();        int endHour = program.getEndTimeHour();        int endMinute = program.getEndTimeMinute();        int endSeconds = program.getEndTimeSeconds();        try {            if (isHourlyAlreadyPassed(startHour, startMinute, startSeconds)) {                if (isHourlyAlreadyPassed(endHour, endMinute, endSeconds)) {                    RecordName recordName = new RecordName(0, RadioLiveALaCarteDataStorage.getInstance().getFileWithoutSegmentsNameByProgramId(programId));                    return recordName;                } else {                    RecordName recordName = new RecordName(1, RadioLiveALaCarteDataStorage.getInstance().getFilesWithSegmentsBaseNameByProgramId(programId));                    return recordName;                }            }            else {                return new RecordName(0, "");            }        } catch (ProutechosBaseException e) {            throw e;        }    }    public String[] getFilesWithoutSegmentNamesList(String userId) throws ProutechosBaseException {        ArrayList<String> fileWithoutSegmentNamesList = new ArrayList<String>();        Program[] programs = this.getProgramsByUserId(userId);        for (Program program : programs) {            System.out.println(programs.toString());        }        for (Program program : programs) {            RecordName recordName = this.getSuitableFileNameByProgramId(program.getId());            if (recordName.getWithSegments() == 0 && (recordName.getOutput_name().isEmpty() == Boolean.FALSE)) {                fileWithoutSegmentNamesList.add(recordName.getOutput_name());            }        }        String[] fileWithoutSegmentNamesArray = new String[fileWithoutSegmentNamesList.size()];        fileWithoutSegmentNamesList.toArray(fileWithoutSegmentNamesArray);        return fileWithoutSegmentNamesArray;    }    public String getFileWithSegmentBaseURL(String userId) throws ProutechosBaseException {        try {            String fileWithSegmentNamesList = "";            Program[] programs = this.getProgramsByUserId(userId);            for (Program program : programs) {                RecordName recordName = this.getSuitableFileNameByProgramId(program.getId());                if (recordName.getWithSegments() == 1) {                    String name = recordName.getOutput_name();                    return name;                }            }            return "";        } catch (ProutechosBaseException e) {            throw e;        }    }    //    //    // SINGLETON    //    //    private static RadioLiveALaCarteUserService _instance = new RadioLiveALaCarteUserService();    private RadioLiveALaCarteUserService() {    }    public static RadioLiveALaCarteUserService getInstance() {        return _instance;    }}